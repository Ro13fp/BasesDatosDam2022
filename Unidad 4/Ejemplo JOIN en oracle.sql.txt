-- EJEMPLO JOIN
-- Dos tablas. En una tabla guardaremos capacidades (cosas que saben hacer) de personas, 
-- y en la otra anotaremos datos de personas. 

DROP TABLE capacidad; 
DROP TABLE persona; 
CREATE TABLE capacidad(
  codigo varchar2(4),
  nombre varchar2(20),
  PRIMARY KEY(codigo)
);
CREATE TABLE persona(
  codigo varchar2(4),
  nombre varchar2(20),
  codcapac varchar2(4),
  PRIMARY KEY(codigo)
);
INSERT INTO capacidad VALUES('js','Progr.Javascript');
INSERT INTO capacidad VALUES('php','Progr.PHP');
INSERT INTO capacidad VALUES ('j','Progr.Java');
INSERT INTO capacidad VALUES  ('sql','Bases datos SQL');
 
INSERT INTO persona VALUES ('ju','Juan','js');
INSERT INTO persona VALUES   ('ja','Javier','php');
INSERT INTO persona VALUES   ('jo','Jose','perl');
INSERT INTO persona VALUES   ('je','Jesus','html');

SELECT * FROM capacidad;
SELECT * FROM persona;
-- Hay dos capacidades para las que no conocemos a ninguna persona; 
-- y existen dos personas que tienen capacidades sobre las que no tenemos ningún detalle.
-- Si mostramos las personas con sus capacidades de la forma que sabemos, sólo aparecerán las parejas de persona 
-- y capacidad para las que existe persona y existe capacidad, es decir:
SELECT * FROM capacidad, persona WHERE persona.codcapac = capacidad.codigo;
-- Resumimos esta consulta, para mostrar sólo los nombres, que son los datos que nos interesan:  
SELECT persona.nombre, capacidad.nombre FROM persona, capacidad WHERE persona.codcapac = capacidad.codigo; 
-- La orden "where" es obligatoria: si no indicamos esa condición, se mostraría el "producto cartesiano" 
-- de las dos tablas: todos los pares (persona, capacidad), aunque no estén relacionados en nuestra base de datos:  
SELECT persona.nombre, capacidad.nombre FROM persona, capacidad;  
-- Con "join" podemos afinar cómo queremos enlazar (en inglés, "join", unir) las tablas. Por ejemplo, si queremos ver todas 
-- las personas y todas las capacidades, aunque no estén relacionadas, como en el ejemplo anterior, 
-- algo que no suele tener sentido en la práctica, lo podríamos hacer con un "cross join" (unir de forma cruzada):  
SELECT persona.nombre, capacidad.nombre FROM persona CROSS JOIN capacidad;
-- Si sólo queremos ver los datos que coinciden en ambas tablas, lo que antes conseguíamos comparando los códigos 
-- con un "where", también podemos usar un "inner join" (unión interior; se puede abreviar simplemente "join"):  
SELECT persona.nombre, capacidad.nombre
FROM persona INNER JOIN capacidad
ON persona.codcapac = capacidad.codigo;
-- Pero aquí llega la novedad: si queremos ver todas las personas y sus capacidades (si existen), 
-- mostrando incluso aquellas personas para las cuales no tenemos constancia de ninguna capacidad, 
-- usaríamos un "left join" (unión por la izquierda, también se puede escribir "left outer join",
-- unión exterior por la izquierda, para dejar claro que se van a incluir datos que están sólo en una de las dos tablas):  
SELECT persona.nombre, capacidad.nombre
FROM persona LEFT OUTER JOIN capacidad
ON persona.codcapac = capacidad.codigo;
-- Si queremos ver todas las capacidades, incluso aquellas para las que no hay detalles sobre personas, 
-- podemos escribir el orden de las tablas al revés en la consulta anterior, o bien usar "right join" (o "right outer join"): 
SELECT persona.nombre, capacidad.nombre
FROM persona RIGHT OUTER JOIN capacidad
ON persona.codcapac = capacidad.codigo;
-- El significado de "LEFT" y de "RIGHT" hay que buscarlo en la posición en la que se enumeran las tablas en el bloque "FROM".
-- Así, la última consulta se puede escribir también como un LEFT JOIN si se indica la capacidad en segundo lugar (en la parte izquierda), así:  
SELECT persona.nombre, capacidad.nombre
FROM capacidad LEFT OUTER JOIN persona
ON persona.codcapac = capacidad.codigo;  