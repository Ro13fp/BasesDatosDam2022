/* Crear las siguientes tablas de acuerdo con las restricciones que se mencionan:
TIENDAS
Columna	    Tipo de dato
NIF	        VARCHAR2(10)
NOMBRE	    VARCHAR2(20)
DIRECCION	VARCHAR2(20)
POBLACION	VARCHAR2(20)
PROVINCIA	VARCHAR2(20)
CODPOSTAL	NUMBER(5)
Crear tabla sin restricciones. Después añadir las siguientes restricciones:

La clave primaria es NIF.
PROVINCIA ha de almacenarse en mayúscula.
Cambia la longitud de NOMBRE a 30 caracteres y no nulo.

FABRICANTES
Columna	        Tipo de dato
COD_FABRICANTE	NUMBER(3)
NOMBRE	        VARCHAR2(15)
PAIS	        VARCHAR2(15)
Restricciones:

La clave primaria es COD_FABRICANTE.
Las columnas NOMBRE y PAIS han de almacenarse en mayúscula.

ARTICULOS
Columna	        Tipo de dato	 
ARTICULO	    VARCHAR2(20)	 
COD_FABRICANTE	NUMBER(3)	 
PESO	        NUMBER(3)	 
CATEGORIA	    VARCHAR2(10)	 
PRECIO_VENTA	NUMBER(6	
PRECIO_COSTO	NUMBER(6	
EXISTENCIAS	    NUMBER(5)	 
Restricciones:

La clave primaria está formada por las columnas: ARTICULO, COD_FABRICANTE, PESO y CATEGORIA.
COD_FABRICANTE es clave ajena que referencia a la tabla FABRICANTES.
PRECIO_VENTA, PRECIO_COSTO y PESO han de ser > 0.
CATEGORIA ha de ser ‘Primera’, ‘Segunda’ o ‘Tercera’.

VENTAS
Columna	           Tipo de dato
NIF	               VARCHAR2(10)
ARTICULO	       VARCHAR2(20)
COD_FABRICANTE     NUMBER(3)
PESO	           NUMBER(3)
CATEGORIA	       VARCHAR2(10)
FECHA_VENTA	       DATE
UNIDADES_VENDIDAS  NUMBER(4)
Restricciones:

La clave primaria está formada por las columnas: NIF, ARTICULO, COD_FABRICANTE, PESO, CATEGORIA y FECHA_VENTA.
NIF es clave ajena que referencia a la tabla TIENDAS.
ARTICULO, COD_FABRICANTE, PESO y CATEGORIA es clave ajena que referencia a la tablas ARTICULOS.
UNIDADES_VENDIDAS han de ser > 0.
CATEGORIA ha de ser ‘Primera’, ‘Segunda’ o ‘Tercera’.

PEDIDOS
Columna         	Tipo de dato
NIF	                VARCHAR2(10)
ARTICULO	        VARCHAR2(20)
COD_FABRICANTE   	NUMBER(3)
PESO	            NUMBER(3)
CATEGORIA	        VARCHAR2(10)
FECHA_PEDIDO	    DATE
UNIDADES_PEDIDAS	NUMBER(4)
EXISTENCIAS	        NUMBER(5)
Restricciones:

La clave primaria está formada por las columnas: NIF, ARTICULO, COD_FABRICANTE, PESO, CATEGORIA y FECHA_PEDIDO.
NIF es clave ajena que referencia a la tabla TIENDAS.
ARTICULO, COD_FABRICANTE, PESO y CATEGORIA es clave ajena que referencia a la tablas ARTICULOS.
UNIDADES_PEDIDAS han de ser > 0.
CATEGORIA ha de ser ‘Primera’, ‘Segunda’ o ‘Tercera’.    */

-- Tabla TIENDAS
CREATE TABLE TIENDAS
(
  NIF        VARCHAR2 (10),
  NOMBRE     VARCHAR2 (20),
  DIRECCION  VARCHAR2 (20),
  POBLACION  VARCHAR2 (20),
  PROVINCIA  VARCHAR2(20),
  CODPOSTAL  NUMBER (5)
);

ALTER TABLE TIENDAS
ADD CONSTRAINT PK_ELNIF PRIMARY KEY (NIF);

ALTER TABLE TIENDAS
ADD CONSTRAINT MAYUSCU CHECK (PROVINCIA = UPPER (PROVINCIA));

ALTER TABLE TIENDAS
MODIFY (NOMBRE VARCHAR2 (30) NOT NULL);


-- Tabla FABRICANTES
CREATE TABLE FABRICANTES
(
  COD_FABRICANTE  NUMBER (3) ,
  NOMBRE          VARCHAR2 (15) ,
  PAIS            VARCHAR2 (15) ,
  CONSTRAINT CODFAB_PK PRIMARY KEY (COD_FABRICANTE),
  CONSTRAINT NOMBRE_MAYUSCULA CHECK (NOMBRE = UPPER(NOMBRE)),
  CONSTRAINT PAIS_MAYUSCULAS CHECK (PAIS = UPPER (PAIS))
);


-- Tabla ARTICULOS
CREATE TABLE ARTICULOS
(
  ARTICULO        VARCHAR2 (20),
  COD_FABRICANTE  NUMBER (3),
  PESO            NUMBER (3),
  CATEGORIA       VARCHAR2 (10),
  PRECIO_VENTA    NUMBER (6,2),
  PRECIO_COSTO    NUMBER (6,2),
  EXISTENCIAS     NUMBER (5),
  CONSTRAINT FK_CODFAB FOREIGN KEY (COD_FABRICANTE)
    REFERENCES FABRICANTES ON DELETE CASCADE,
  CONSTRAINT PK_CLAVEP
    PRIMARY KEY (ARTICULO, COD_FABRICANTE, PESO,  CATEGORIA),
  CONSTRAINT MAYORQUE0
    CHECK (PRECIO_VENTA > 0 AND PRECIO_COSTO > 0 AND PESO > 0),
  CONSTRAINT CATEGORI
    CHECK (CATEGORIA IN ('PRIMERA', 'SEGUNDA', 'TERCERA'))
);


-- Tabla VENTAS
CREATE TABLE VENTAS
(
  NIF                VARCHAR2 (10),
  ARTICULO           VARCHAR2 (20),
  COD_FABRICANTE     NUMBER (3),
  PESO               NUMBER (3),
  CATEGORIA          VARCHAR2 (10),
  FECHA_VENTA        DATE,
  UNIDADES_VENDIDAS  NUMBER (4),
  CONSTRAINT PK_CLAVEPV PRIMARY KEY
    (NIF, ARTICULO, COD_FABRICANTE, PESO, CATEGORIA,FECHA_VENTA),
  CONSTRAINT VENDIDAS_MAY0 CHECK (UNIDADES_VENDIDAS >0),
  CONSTRAINT CATEGORIV
    CHECK (CATEGORIA IN ('PRIMERA', 'SEGUNDA', 'TERCERA')),
  CONSTRAINT FK_CLAVEAJEV
    FOREIGN KEY (ARTICULO, COD_FABRICANTE, PESO, CATEGORIA)
    REFERENCES ARTICULOS ON DELETE CASCADE,
  CONSTRAINT FK_NIFV FOREIGN KEY (NIF)
    REFERENCES TIENDAS ON DELETE CASCADE
);


-- Tabla PEDIDOS
CREATE TABLE PEDIDOS
(
  NIF               VARCHAR2 (10),
  ARTICULO          VARCHAR2 (20),
  COD_FABRICANTE    NUMBER (3),
  PESO              NUMBER (3),
  CATEGORIA         VARCHAR2 (10),
  FECHA_PEDIDO      DATE,
  UNIDADES_PEDIDAS  NUMBER (4),
  EXISTENCIAS       NUMBER (5),
  CONSTRAINT PK_CLAVEPP PRIMARY KEY
    (NIF, ARTICULO, COD_FABRICANTE, PESO, CATEGORIA,FECHA_PEDIDO),
  CONSTRAINT FK_CLAVENIFP FOREIGN KEY (NIF)
    REFERENCES TIENDAS ON DELETE CASCADE,
  CONSTRAINT FK_CLAVEAJEP
    FOREIGN KEY (ARTICULO, COD_FABRICANTE, PESO, CATEGORIA)
    REFERENCES ARTICULOS ON DELETE CASCADE,
  CONSTRAINT CATEGORIP
    CHECK (CATEGORIA IN ('PRIMERA', 'SEGUNDA', 'TERCERA'))
);

--  Añadir una restricción a la tabla TIENDAS para que el NOMBRE de la tienda sea de tipo título (InitCap)
ALTER TABLE TIENDAS
ADD CONSTRAINT NOMBRETIENDAMAY CHECK (NOMBRE = INITCAP (NOMBRE));

INSERT INTO TIENDAS
VALUES (16789654, 'romero', 'Valderejo 5', 'VIZCAYA', 'EREMUA', 56342);

-- Visualizar las CONSTRAINTS definidas para las tablas anteriores
SELECT CONSTRAINT_NAME, COLUMN_NAME FROM USER_CONS_COLUMNS WHERE TABLE_NAME = 'TIENDAS';

-- Modificar las columnas de las tablas PEDIDOS y VENTAS para que las UNIDADES_VENDIDAS y las UNIDADES_PEDIDAS 
-- puedan almacenar cantidades numéricas de 6 dígitos
ALTER TABLE PEDIDOS
MODIFY (UNIDADES_PEDIDAS NUMBER (6));

ALTER TABLE VENTAS
MODIFY (UNIDADES_VENDIDAS NUMBER (6));

-- Impedir que se den de alta más tiendas en la provincia de ‘TOLEDO’.
ALTER TABLE TIENDAS
ADD CONSTRAINT PROVNOTOLEDO CHECK (PROVINCIA != 'TOLEDO');

-- Añadir a las tablas PEDIDOS y VENTAS una nueva columna para que almacenen el PVP del artículo
ALTER TABLE PEDIDOS ADD (PVP NUMBER (9));

ALTER TABLE VENTAS  ADD (PVP NUMBER (9));





















































